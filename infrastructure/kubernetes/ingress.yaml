apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: moodmelodies-ingress
  namespace: moodmelodies
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/websocket-services: signaling
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
spec:
  tls:
  - hosts:
    - signaling.moodmelodies.app
    - translation.moodmelodies.app
    secretName: moodmelodies-tls
  rules:
  - host: signaling.moodmelodies.app
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: signaling
            port:
              number: 3000
  - host: translation.moodmelodies.app
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: translation
            port:
              number: 7777
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: moodmelodies-config
  namespace: moodmelodies
data:
  redis-host: redis.moodmelodies.svc.cluster.local
  allowed-origins: "https://moodmelodies.app,https://*.moodmelodies.app"
---
apiVersion: v1
kind: Secret
metadata:
  name: moodmelodies-secrets
  namespace: moodmelodies
type: Opaque
data:
  jwt-secret: <base64-encoded-secret>
  redis-password: <base64-encoded-password>


